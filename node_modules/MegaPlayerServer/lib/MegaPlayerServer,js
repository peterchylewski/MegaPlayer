'use strict';

var PORT = process.env.PORT || 5002,
	//compression = require('compression'),
	express = require('express'),
	app = express(), io;


var MegaPlayerServer = function() {
	console.log('MegaPlayerServer!');
	
	function _listenToSocket(socket) {
			socket.on('ready', function() {
				console.log('ready command received');
				socket.emit('radiostations', require(process.cwd() + '/radiostations.json'));
			});
	}
	
	this.start = function() {
		app.use(express.static('public'));
		var server = app.listen(PORT, function () {
			var host = server.address().address,
				port = server.address().port;
				
			console.info('listening at http://%s:%s', host, port);
			
			io = require('socket.io').listen(server);
			io.on('connection', function(socket) {
				console.log('a user connected');
				_listenToSocket(socket)
			});
		});
	};
};

module.exports = new MegaPlayerServer();
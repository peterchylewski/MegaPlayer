<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	
	<title>MPLayerTunez</title>

	<link rel="stylesheet" href="style/bootstrap.min.css">
	<link rel="stylesheet" href="style/elusive-webfont.css">
	<link rel="stylesheet" href="style/fonts/Franklin/Franklin.font.css">
	<style media="screen">
			
		* {
			-webkit-font-smoothing: antialiased;
			text-rendering: optimizeLegibility;
			margin: 0;
			padding: 0;
			outline: 0 !important;
			-moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
		}

		body {
			font-family: "FranklinGothicFSBook" !important;
			text-transform: lowercase;
			margin: 32px;
			color: #333;
			background: #fff;
		}
		
		h1, h2, h3, h4, h5, h6 {
			font-family: "FranklinGothicFSHeavy" !important;
			font-weight: 400 !important;
			font-style: normal !important;
			margin: 0;
		}
		
		h1 { font-size: 3em; letter-spacing: -.01em; color: } h2 { font-size: 1.8em; }
		
		h1 {
			font-size: 6em;
			line-height: .85em;
			letter-spacing: -.045em;
			color: #D3D3D3;
		}

		* + h1, * + h2, * + h3, * + h4, * + h5, * + h6 { margin-top: 16px; }
		
		ul, ol { list-style-position: inside; }
		
		* + p { margin-top: 8px; }
		
		ul li {
			list-style-type: none;
			margin: 0;
		}
		
		/* table#main { width: 100%; } */
		
		td#stations {
			padding-top: 6px;
			min-width: 200px;
		}
		
		td#stations li { white-space: nobreak; }
		
		td {
			vertical-align: top;
			border: 1px solid #eee;
		}
		
		td#info { padding-left: 32px; }
		
		h1 { min-height: 70px; }
		
		.el-icon-volume-up {
			position: relative;
			top: 1px;
			padding-left: 6px;
			display: none;
		}
		
		.el-icon-volume-up.active { display: inline; }
	
	</style>

	<script src="js/jquery-2.0.3.min.js"></script>
	<script src="js/underscore-min.js"></script>
	<script src="js/socket.io-1.2.1.js"></script>

	<script>

		'use strict';
		
		var socket = io('http://192.168.1.200:3000/'),
			_stations,
			_stationIDs,
			_currentStationID;
		
		function _setStation(id) {
			if (id !== undefined) {
				_currentStationID = id;
				socket.emit('station', _currentStationID);
			}
		}
		
		function _previousStation() {
				var currentIndex = _.indexOf(_stationIDs, _currentStationID),
					nextIndex = currentIndex - 1;
				if (nextIndex < 0 ) { nextIndex = _stationIDs.length - 1 ; }
				_setStation(_stationIDs[nextIndex]);
		}
		
		function _nextStation() {
			var currentIndex = _.indexOf(_stationIDs, _currentStationID),
				nextIndex = currentIndex + 1;
			if (nextIndex >= _stationIDs.length) { nextIndex = 0; }
			_setStation(_stationIDs[nextIndex]);
		}
		
		socket.on('radiostations', function(stations) {
			console.log('radio stations received: ', stations);
			
			_stations = stations;
			_stationIDs = _.keys(_stations);
			
			var html = $('#template').html(),
				template = _.template(html);

			$('#stations').html(template({ data: stations }));
			$('a.station').click(function(e) {
				console.log('klik');
				e.preventDefault();
				_setStation($(this).attr('href'));
			});
		});
		
		socket.on('station_id', function(id) {
			console.log('station id', id);
			_currentStationID = id;
			$('li i').removeClass('active');
			$('li[data-id="' + id + '"] i').addClass('active');
		});
		
		socket.on('station_message', function(msg) {
			$('h1').text(msg);
		});
		
		socket.on('previous_station', function() {
			_previousStation();
		});
		
		socket.on('next_station', function() {
			_nextStation();
		});
		
		socket.on('connection', function() {
			console.log('connected to server');
		});
		
		socket.on('welcome', function(msg) {
			console.log(msg);
		});
		
		socket.on('disconnect', function() {
			console.log('disconnected from server');
		});
		
		$(document).ready(function() {
			console.log('***ready');
			socket.emit('ready', 'foobar');
			
			$('button[data-action="prev_station"]').click(function() {
				_previousStation();
			});
			
			$('button[data-action="next_station"]').click(function() {
				_nextStation();
			});
			
			$('button[data-action="stop"]').click(function() {
				console.log('tsop');
				socket.emit('cmd', 'stop');
			});
			
		});

	</script>
	
	<script id="template" type="text/template">
	 	<h2>Radio stations</h2>
		<% console.log(data); %>
		<ul>
		<% _.each(data, function(value, key) { %>
			<li data-id="<%= key %>"><a class="station" href="<%= key %>"><%= value.name %><i class="el-icon-volume-up"></a></i></li>
		<% }); %>
		</ul>
	</script>
</head>
<body>
	<table id="main">
		<tr>
			<td id="stations"></td>
			<td id="info">
				<h1 ></h1>
			</td>
		</tr>
	</table>
	<h3 ></h3>
	
	
	<p>
		<button class="btn btn-primary" data-action="prev_station">previous station</button>
		<button class="btn btn-primary" data-action="next_station">next station</button>
	</p>
	<p>
		<button class="btn btn-warning" data-action="stop">stop</button>
	</p>
</body>


</html>